'use strict';

;
(function () {

	function animate(draw, duration) {
		var start = performance.now();

		requestAnimationFrame(function animate(time) {
			// определить, сколько прошло времени с начала анимации
			var timePassed = time - start;

			// возможно небольшое превышение времени, в этом случае зафиксировать конец
			if (timePassed > duration) timePassed = duration;

			// нарисовать состояние анимации в момент timePassed
			draw(timePassed);

			// если время анимации не закончилось - запланировать ещё кадр
			if (timePassed < duration) {
				requestAnimationFrame(animate);
			}
		});
	}

	var config = {
		colors: {
			neutral: '#FFA700', // #8D99AE #107E7D
			success: '#C2E812',
			fail: '#B80C09'
		},
		movements: {
			radiusPercent: 4,
			strokeWidthPercent: 0.5
		}
	};

	// **********
	// * CANVAS *
	// **********

	// Changes canvas background size when fired
	function refreshComputedSizes(object) {

		config.canvOpts.computedStyle = {
			width: +object.width.slice(0, -2),
			height: +object.height.slice(0, -2)
		};

		canvas.setDimensions({
			width: config.canvOpts.computedStyle.width,
			height: config.canvOpts.computedStyle.height
		});
	}

	function addMovementOnCanvas(movementInfo) {

		var radius = config.canvOpts.movements.radius;
		var strokeWidth = config.canvOpts.movements.strokeWidth;
		// var x = Math.round(config.canvOpts.computedStyle.width - (config.canvOpts.computedStyle.width/100)*3) - radius*2;
		var x = Math.round(config.canvOpts.computedStyle.width);
		var y = Math.round(config.oneHPercent * 45);

		// console.log(x + ' - ' + y);

		var movement = new fabric.Circle({
			fill: movementInfo.color,
			stroke: '#FFFFFF',
			strokeWidth: strokeWidth,
			radius: radius,
			// radius: 100,
			top: y,
			left: x
			// left: 262
		});

		movementInfo.canvasObject = movement;

		console.log(movement);
		canvas.add(movement);
		canvas.renderAll();
		// movementInfo.state = 'added';
	}

	// Actions performed when current game settings recieved
	function onAgSetupEvent(event) {

		var audioFileURL = 'http://' + window.location.hostname + '/songs/' + event.detail.song;
		// let audioFileURL = '../audio/' + event.detail.song;

		// console.log(audioFileURL);

		config.currentAudio = new Howl({
			urls: [audioFileURL],
			autoplay: false,
			volume: 0.8
		});

		config.currentMovements = event.detail.commands.map(function (currentValue, index, array) {
			return {
				index: index,
				name: currentValue,
				color: config.colors.neutral
			};
		});

		// BPM, minInterval, beginning offset
		// config.currentBpm = event.detail.bpm;
		config.currentBpm = 128;
		config.currentMinInterval = config.currentBpm * 1000 / (60 * 16);
		config.currentBeginningOffset = event.detail.offset;

		// Test
		// addMovementOnCanvas(config.currentMovements[1]);
		start();
	}

	function start() {
		config.currentScore = 0;
		config.currentStartDate = Date.now();
		setTimeout(function () {
			nextBeat(true);
		}, config.currentBeginningOffset);
		config.currentAudio.start();
	}

	function nextBeat(isFirst) {

		// If we're in the beginning of song
		if (isFirst === true) {
			addMovementOnCanvas(config.currentMovements[0]);
			animateMovement(config.currentMovements[0]);
			setTimeout(nextBeat, config.currentMinInterval);
			return;
		}

		// Insert new movement
		var appearingMovementIndex = Math.floor((Date.now() - config.currentStartDate) / config.currentMinInterval);
		console.log(appearingMovementIndex);
		var appearingMovement = config.currentMovements[appearingMovementIndex];

		addMovementOnCanvas(appearingMovement);
		animateMovement(appearingMovement);
		setTimeout(nextBeat, config.currentMinInterval);
		console.log(appearingMovementIndex);
	}

	function animateMovement(movementInfo) {
		// movementInfo.canvasObject.animate('left', ''+(config.oneWPercent * 20), {
		// 	// onChange: canvas.renderAll.bind(canvas),
		// 	onChange: requestAnimationFrame(canvas.renderAll.bind(canvas), 100),
		// 	// duration: config.currentMinInterval*16
		// });

		animate(function (time) {
			movementInfo.canvasObject.setLeft(time / config.currentMinInterval * 16 + config.oneWPercent * 20);
			canvas.renderAll.bind(canvas);
		}, config.currentMinInterval * 16);
	}

	// Mutes / unmutes audio
	function onVolumeBtnClick(event) {

		if (!config.currentAudio.muted) {

			// Change view
			this.childNodes[1].classList.remove('fa-volume-up');
			this.childNodes[1].classList.add('fa-volume-off');

			// Mute
			config.currentAudio.mute();
			config.currentAudio.muted = true;
		} else {

			// Change view
			this.childNodes[1].classList.remove('fa-volume-off');
			this.childNodes[1].classList.add('fa-volume-up');

			// Unmute
			config.currentAudio.unmute();
			config.currentAudio.muted = false;
		}
		console.log(this);
	}

	// Change volume level of current audio
	function onVolumeSliderInput(event) {
		config.currentAudio.volume(this.value / 100);
	}

	function updateScore(add) {

		var score = document.querySelectorAll('.score')[0];
		var scoreNumber = document.querySelectorAll('.score-number')[0];

		score.classList.add('update');
		setTimeout(function () {
			score.classList.remove('update');
		}, 400);

		config.currentScore += parseInt(add);
		scoreNumber.innerHTML = config.currentScore;

		return config.currentScore;
	}

	// ********
	// * Init *
	// ********

	config.currentAudio;
	config.currentMovements = [];
	config.currentScore = 0;
	config.currentStartDate = 0;

	// Get computed styles of whole page wrapper
	var canvasComputedStyleObj = getComputedStyle(document.querySelectorAll('.wr')[0]);

	// Set canvas options
	config.oneWPercent = parseInt(canvasComputedStyleObj.width.slice(0, -2)) / 100;
	config.oneHPercent = parseInt(canvasComputedStyleObj.height.slice(0, -2)) / 100;

	config.canvOpts = {
		bgURL: '../img/bg-crowd-1.jpg',
		computedStyle: {
			width: config.oneWPercent * 100,
			height: config.oneHPercent * 100
		},
		movements: {
			radius: config.oneWPercent * config.movements.radiusPercent,
			strokeWidth: config.oneWPercent * config.movements.strokeWidthPercent
		}
	};

	// Initialize 'fabric' canvas obj
	var canvas = new fabric.StaticCanvas('game', {
		width: config.canvOpts.computedStyle.width,
		height: config.canvOpts.computedStyle.height
	});

	// var topTriangle = new fabric.Triangle({
	// 	fill: config.colors.neutral,
	// 	stroke: '#FFFFFF',
	// 	strokeWidth: config.canvOpts.movements.strokeWidth,
	// 	height: config.oneHPercent * 15,
	// 	width: config.onehPercent * 15,
	// 	top: (config.oneHPercent * 20) + (config.oneHPercent * 15),
	// 	left: (config.oneWPercent * 20) + (config.oneHPercent * 15),
	// 	centeredRotation: true,
	// 	angle: 180
	// });

	// var bottomTriangle = new fabric.Triangle({
	// 	fill: config.colors.neutral,
	// 	stroke: '#FFFFFF',
	// 	strokeWidth: config.canvOpts.movements.strokeWidth,
	// 	height: config.oneHPercent * 15,
	// 	width: config.onehPercent * 15,
	// 	top: config.oneHPercent * 75,
	// 	left: config.oneWPercent * 19.5
	// });

	var shadowCircle = new fabric.Circle({
		// fill: config.colors.neutral,
		fill: 'rgba(200,200,200,0.2)',
		stroke: 'rgba(200,200,200,1)',
		strokeWidth: config.canvOpts.movements.strokeWidth,
		radius: config.canvOpts.movements.radius,
		top: Math.round(config.oneHPercent * 45),
		left: config.oneWPercent * 20
	});
	canvas.add(shadowCircle);

	// Set handler for game setup event
	document.addEventListener('agSetupEvent', onAgSetupEvent);

	// *********
	// * Audio *
	// *********

	// Add muted state saving feature to Howl (audio lib)
	Howl.prototype.muted = false;
	Howl.muted = false;

	// Get volume button element
	var volumeBtn = document.querySelectorAll('.volume-btn')[0];
	// and set onClick event handler
	volumeBtn.addEventListener('click', onVolumeBtnClick);

	// Get volume level slider
	var volumeSlider = document.querySelectorAll('.volume-input')[0];
	// and set onInput event handler
	volumeSlider.addEventListener('input', onVolumeSliderInput);

	// Change canvas background size on window resize
	window.onresize = function () {
		refreshComputedSizes(canvasComputedStyleObj);
		canvas.renderAll.bind(canvas);
	};

	// test

	// config.currentAudio = new Howl({
	// 		urls: ['../audio/12 Home.mp3'],
	// 		autoplay: false,
	// 		volume: 0.8,
	// 	});
	// config.currentAudio.play();

	window.updateScore = updateScore;
	// window.bla = addMovementOnCanvas;
	// document.addEventListener('mousemove', function(){
	// 	config.currentMovements[1].canvasObject.animate('left', '-=1050', {
	// 		onChange: canvas.renderAll.bind(canvas),
	// 		duration: 2400,
	// 		easing: fabric.util.linear
	// 	});
	// });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbmRlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0EsQ0FBQyxZQUFVOztBQUVYLFVBQVMsT0FBVCxDQUFpQixJQUFqQixFQUF1QixRQUF2QixFQUFpQztBQUMvQixNQUFJLFFBQVEsWUFBWSxHQUFaLEVBQVo7O0FBRUEsd0JBQXNCLFNBQVMsT0FBVCxDQUFpQixJQUFqQixFQUF1Qjs7QUFFM0MsT0FBSSxhQUFhLE9BQU8sS0FBeEI7OztBQUdBLE9BQUksYUFBYSxRQUFqQixFQUEyQixhQUFhLFFBQWI7OztBQUczQixRQUFLLFVBQUw7OztBQUdBLE9BQUksYUFBYSxRQUFqQixFQUEyQjtBQUN6QiwwQkFBc0IsT0FBdEI7QUFDRDtBQUVGLEdBZkQ7QUFnQkQ7O0FBR0QsS0FBSSxTQUFTO0FBQ1osVUFBUTtBQUNQLFlBQVMsU0FERixFO0FBRVAsWUFBUyxTQUZGO0FBR1AsU0FBTTtBQUhDLEdBREk7QUFNWixhQUFXO0FBQ1Ysa0JBQWUsQ0FETDtBQUVWLHVCQUFvQjtBQUZWO0FBTkMsRUFBYjs7Ozs7OztBQWtCQSxVQUFTLG9CQUFULENBQThCLE1BQTlCLEVBQXNDOztBQUVyQyxTQUFPLFFBQVAsQ0FBZ0IsYUFBaEIsR0FBZ0M7QUFDL0IsVUFBTyxDQUFDLE9BQU8sS0FBUCxDQUFhLEtBQWIsQ0FBbUIsQ0FBbkIsRUFBcUIsQ0FBQyxDQUF0QixDQUR1QjtBQUUvQixXQUFRLENBQUMsT0FBTyxNQUFQLENBQWMsS0FBZCxDQUFvQixDQUFwQixFQUFzQixDQUFDLENBQXZCO0FBRnNCLEdBQWhDOztBQUtBLFNBQU8sYUFBUCxDQUFxQjtBQUNwQixVQUFPLE9BQU8sUUFBUCxDQUFnQixhQUFoQixDQUE4QixLQURqQjtBQUVwQixXQUFRLE9BQU8sUUFBUCxDQUFnQixhQUFoQixDQUE4QjtBQUZsQixHQUFyQjtBQUtBOztBQUVELFVBQVMsbUJBQVQsQ0FBNkIsWUFBN0IsRUFBMkM7O0FBRTFDLE1BQUksU0FBUyxPQUFPLFFBQVAsQ0FBZ0IsU0FBaEIsQ0FBMEIsTUFBdkM7QUFDQSxNQUFJLGNBQWMsT0FBTyxRQUFQLENBQWdCLFNBQWhCLENBQTBCLFdBQTVDOztBQUVBLE1BQUksSUFBSSxLQUFLLEtBQUwsQ0FBVyxPQUFPLFFBQVAsQ0FBZ0IsYUFBaEIsQ0FBOEIsS0FBekMsQ0FBUjtBQUNBLE1BQUksSUFBSSxLQUFLLEtBQUwsQ0FBVyxPQUFPLFdBQVAsR0FBcUIsRUFBaEMsQ0FBUjs7OztBQUlBLE1BQUksV0FBVyxJQUFJLE9BQU8sTUFBWCxDQUFrQjtBQUNoQyxTQUFNLGFBQWEsS0FEYTtBQUVoQyxXQUFRLFNBRndCO0FBR2hDLGdCQUFhLFdBSG1CO0FBSWhDLFdBQVEsTUFKd0I7O0FBTWhDLFFBQUssQ0FOMkI7QUFPaEMsU0FBTTs7QUFQMEIsR0FBbEIsQ0FBZjs7QUFXQSxlQUFhLFlBQWIsR0FBNEIsUUFBNUI7O0FBRUEsVUFBUSxHQUFSLENBQVksUUFBWjtBQUNBLFNBQU8sR0FBUCxDQUFXLFFBQVg7QUFDQSxTQUFPLFNBQVA7O0FBRUE7OztBQUlELFVBQVMsY0FBVCxDQUF3QixLQUF4QixFQUErQjs7QUFFOUIsTUFBSSxlQUFlLFlBQVksT0FBTyxRQUFQLENBQWdCLFFBQTVCLEdBQXVDLFNBQXZDLEdBQW1ELE1BQU0sTUFBTixDQUFhLElBQW5GOzs7OztBQUtBLFNBQU8sWUFBUCxHQUFzQixJQUFJLElBQUosQ0FBUztBQUM5QixTQUFNLENBQUMsWUFBRCxDQUR3QjtBQUU5QixhQUFVLEtBRm9CO0FBRzlCLFdBQVE7QUFIc0IsR0FBVCxDQUF0Qjs7QUFNQSxTQUFPLGdCQUFQLEdBQTBCLE1BQU0sTUFBTixDQUFhLFFBQWIsQ0FBc0IsR0FBdEIsQ0FBMEIsVUFBQyxZQUFELEVBQWUsS0FBZixFQUFzQixLQUF0QixFQUFnQztBQUNsRixVQUFPO0FBQ04sV0FBTyxLQUREO0FBRU4sVUFBTSxZQUZBO0FBR04sV0FBTyxPQUFPLE1BQVAsQ0FBYztBQUhmLElBQVA7QUFLRCxHQU55QixDQUExQjs7OztBQVVBLFNBQU8sVUFBUCxHQUFvQixHQUFwQjtBQUNBLFNBQU8sa0JBQVAsR0FBNkIsT0FBTyxVQUFQLEdBQW9CLElBQXJCLElBQThCLEtBQUssRUFBbkMsQ0FBNUI7QUFDQSxTQUFPLHNCQUFQLEdBQWdDLE1BQU0sTUFBTixDQUFhLE1BQTdDOzs7O0FBSUE7QUFFQTs7QUFFRCxVQUFTLEtBQVQsR0FBaUI7QUFDaEIsU0FBTyxZQUFQLEdBQXNCLENBQXRCO0FBQ0EsU0FBTyxnQkFBUCxHQUEwQixLQUFLLEdBQUwsRUFBMUI7QUFDQSxhQUFXLFlBQVU7QUFDcEIsWUFBUyxJQUFUO0FBQ0EsR0FGRCxFQUVHLE9BQU8sc0JBRlY7QUFHQSxTQUFPLFlBQVAsQ0FBb0IsS0FBcEI7QUFDQTs7QUFFRCxVQUFTLFFBQVQsQ0FBa0IsT0FBbEIsRUFBMkI7OztBQUcxQixNQUFJLFlBQVksSUFBaEIsRUFBc0I7QUFDckIsdUJBQW9CLE9BQU8sZ0JBQVAsQ0FBd0IsQ0FBeEIsQ0FBcEI7QUFDQSxtQkFBZ0IsT0FBTyxnQkFBUCxDQUF3QixDQUF4QixDQUFoQjtBQUNBLGNBQVcsUUFBWCxFQUFxQixPQUFPLGtCQUE1QjtBQUNBO0FBQ0E7OztBQUdELE1BQUkseUJBQXlCLEtBQUssS0FBTCxDQUFXLENBQUMsS0FBSyxHQUFMLEtBQWEsT0FBTyxnQkFBckIsSUFBeUMsT0FBTyxrQkFBM0QsQ0FBN0I7QUFDQSxVQUFRLEdBQVIsQ0FBWSxzQkFBWjtBQUNBLE1BQUksb0JBQW9CLE9BQU8sZ0JBQVAsQ0FBd0Isc0JBQXhCLENBQXhCOztBQUVBLHNCQUFvQixpQkFBcEI7QUFDQSxrQkFBZ0IsaUJBQWhCO0FBQ0EsYUFBVyxRQUFYLEVBQXFCLE9BQU8sa0JBQTVCO0FBQ0EsVUFBUSxHQUFSLENBQVksc0JBQVo7QUFFQTs7QUFFRCxVQUFTLGVBQVQsQ0FBeUIsWUFBekIsRUFBdUM7Ozs7Ozs7QUFPdEMsVUFBUSxVQUFTLElBQVQsRUFBYztBQUNyQixnQkFBYSxZQUFiLENBQTBCLE9BQTFCLENBQW9DLE9BQUssT0FBTyxrQkFBWixHQUErQixFQUFoQyxHQUFzQyxPQUFPLFdBQVAsR0FBbUIsRUFBNUY7QUFDQSxVQUFPLFNBQVAsQ0FBaUIsSUFBakIsQ0FBc0IsTUFBdEI7QUFDQSxHQUhELEVBR0csT0FBTyxrQkFBUCxHQUEwQixFQUg3QjtBQUlBOzs7QUFJRCxVQUFTLGdCQUFULENBQTBCLEtBQTFCLEVBQWlDOztBQUVoQyxNQUFJLENBQUMsT0FBTyxZQUFQLENBQW9CLEtBQXpCLEVBQWdDOzs7QUFHL0IsUUFBSyxVQUFMLENBQWdCLENBQWhCLEVBQW1CLFNBQW5CLENBQTZCLE1BQTdCLENBQW9DLGNBQXBDO0FBQ0EsUUFBSyxVQUFMLENBQWdCLENBQWhCLEVBQW1CLFNBQW5CLENBQTZCLEdBQTdCLENBQWlDLGVBQWpDOzs7QUFHQSxVQUFPLFlBQVAsQ0FBb0IsSUFBcEI7QUFDQSxVQUFPLFlBQVAsQ0FBb0IsS0FBcEIsR0FBNEIsSUFBNUI7QUFDQSxHQVRELE1BU087OztBQUdOLFFBQUssVUFBTCxDQUFnQixDQUFoQixFQUFtQixTQUFuQixDQUE2QixNQUE3QixDQUFvQyxlQUFwQztBQUNBLFFBQUssVUFBTCxDQUFnQixDQUFoQixFQUFtQixTQUFuQixDQUE2QixHQUE3QixDQUFpQyxjQUFqQzs7O0FBR0EsVUFBTyxZQUFQLENBQW9CLE1BQXBCO0FBQ0EsVUFBTyxZQUFQLENBQW9CLEtBQXBCLEdBQTRCLEtBQTVCO0FBQ0E7QUFDRCxVQUFRLEdBQVIsQ0FBWSxJQUFaO0FBRUE7OztBQUdELFVBQVMsbUJBQVQsQ0FBNkIsS0FBN0IsRUFBb0M7QUFDbkMsU0FBTyxZQUFQLENBQW9CLE1BQXBCLENBQTJCLEtBQUssS0FBTCxHQUFXLEdBQXRDO0FBQ0E7O0FBRUQsVUFBUyxXQUFULENBQXFCLEdBQXJCLEVBQTBCOztBQUV6QixNQUFJLFFBQVEsU0FBUyxnQkFBVCxDQUEwQixRQUExQixFQUFvQyxDQUFwQyxDQUFaO0FBQ0EsTUFBSSxjQUFjLFNBQVMsZ0JBQVQsQ0FBMEIsZUFBMUIsRUFBMkMsQ0FBM0MsQ0FBbEI7O0FBRUEsUUFBTSxTQUFOLENBQWdCLEdBQWhCLENBQW9CLFFBQXBCO0FBQ0EsYUFBVyxZQUFJO0FBQUUsU0FBTSxTQUFOLENBQWdCLE1BQWhCLENBQXVCLFFBQXZCO0FBQW1DLEdBQXBELEVBQXNELEdBQXREOztBQUVBLFNBQU8sWUFBUCxJQUF1QixTQUFTLEdBQVQsQ0FBdkI7QUFDQSxjQUFZLFNBQVosR0FBd0IsT0FBTyxZQUEvQjs7QUFFQSxTQUFPLE9BQU8sWUFBZDtBQUVBOzs7Ozs7QUFTRCxRQUFPLFlBQVA7QUFDQSxRQUFPLGdCQUFQLEdBQTBCLEVBQTFCO0FBQ0EsUUFBTyxZQUFQLEdBQXNCLENBQXRCO0FBQ0EsUUFBTyxnQkFBUCxHQUEwQixDQUExQjs7O0FBR0EsS0FBSSx5QkFBeUIsaUJBQWlCLFNBQVMsZ0JBQVQsQ0FBMEIsS0FBMUIsRUFBaUMsQ0FBakMsQ0FBakIsQ0FBN0I7OztBQUlBLFFBQU8sV0FBUCxHQUFxQixTQUFTLHVCQUF1QixLQUF2QixDQUE2QixLQUE3QixDQUFtQyxDQUFuQyxFQUFxQyxDQUFDLENBQXRDLENBQVQsSUFBbUQsR0FBeEU7QUFDQSxRQUFPLFdBQVAsR0FBcUIsU0FBUyx1QkFBdUIsTUFBdkIsQ0FBOEIsS0FBOUIsQ0FBb0MsQ0FBcEMsRUFBc0MsQ0FBQyxDQUF2QyxDQUFULElBQW9ELEdBQXpFOztBQUVBLFFBQU8sUUFBUCxHQUFrQjtBQUNqQixTQUFPLHVCQURVO0FBRWpCLGlCQUFlO0FBQ2QsVUFBTyxPQUFPLFdBQVAsR0FBbUIsR0FEWjtBQUVkLFdBQVEsT0FBTyxXQUFQLEdBQW1CO0FBRmIsR0FGRTtBQU1qQixhQUFXO0FBQ1YsV0FBUSxPQUFPLFdBQVAsR0FBcUIsT0FBTyxTQUFQLENBQWlCLGFBRHBDO0FBRVYsZ0JBQWEsT0FBTyxXQUFQLEdBQXFCLE9BQU8sU0FBUCxDQUFpQjtBQUZ6QztBQU5NLEVBQWxCOzs7QUFjQSxLQUFJLFNBQVMsSUFBSSxPQUFPLFlBQVgsQ0FBd0IsTUFBeEIsRUFBZ0M7QUFDNUMsU0FBTyxPQUFPLFFBQVAsQ0FBZ0IsYUFBaEIsQ0FBOEIsS0FETztBQUU1QyxVQUFRLE9BQU8sUUFBUCxDQUFnQixhQUFoQixDQUE4QjtBQUZNLEVBQWhDLENBQWI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCQSxLQUFJLGVBQWUsSUFBSSxPQUFPLE1BQVgsQ0FBa0I7O0FBRXBDLFFBQU0sdUJBRjhCO0FBR3BDLFVBQVEscUJBSDRCO0FBSXBDLGVBQWEsT0FBTyxRQUFQLENBQWdCLFNBQWhCLENBQTBCLFdBSkg7QUFLcEMsVUFBUSxPQUFPLFFBQVAsQ0FBZ0IsU0FBaEIsQ0FBMEIsTUFMRTtBQU1wQyxPQUFLLEtBQUssS0FBTCxDQUFXLE9BQU8sV0FBUCxHQUFtQixFQUE5QixDQU4rQjtBQU9wQyxRQUFNLE9BQU8sV0FBUCxHQUFxQjtBQVBTLEVBQWxCLENBQW5CO0FBU0EsUUFBTyxHQUFQLENBQVcsWUFBWDs7O0FBR0EsVUFBUyxnQkFBVCxDQUEwQixjQUExQixFQUEwQyxjQUExQzs7Ozs7OztBQU9BLE1BQUssU0FBTCxDQUFlLEtBQWYsR0FBdUIsS0FBdkI7QUFDQSxNQUFLLEtBQUwsR0FBYSxLQUFiOzs7QUFHQSxLQUFJLFlBQVksU0FBUyxnQkFBVCxDQUEwQixhQUExQixFQUF5QyxDQUF6QyxDQUFoQjs7QUFFQSxXQUFVLGdCQUFWLENBQTJCLE9BQTNCLEVBQW9DLGdCQUFwQzs7O0FBR0EsS0FBSSxlQUFlLFNBQVMsZ0JBQVQsQ0FBMEIsZUFBMUIsRUFBMkMsQ0FBM0MsQ0FBbkI7O0FBRUEsY0FBYSxnQkFBYixDQUE4QixPQUE5QixFQUF1QyxtQkFBdkM7OztBQUlBLFFBQU8sUUFBUCxHQUFrQixZQUFVO0FBQzNCLHVCQUFxQixzQkFBckI7QUFDQSxTQUFPLFNBQVAsQ0FBaUIsSUFBakIsQ0FBc0IsTUFBdEI7QUFDQSxFQUhEOzs7Ozs7Ozs7OztBQWtCQSxRQUFPLFdBQVAsR0FBcUIsV0FBckI7Ozs7Ozs7OztBQVVDLENBL1VEIiwiZmlsZSI6InJlbmRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIjtcbihmdW5jdGlvbigpe1xuXG5mdW5jdGlvbiBhbmltYXRlKGRyYXcsIGR1cmF0aW9uKSB7XG4gIHZhciBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiBhbmltYXRlKHRpbWUpIHtcbiAgICAvLyDQvtC/0YDQtdC00LXQu9C40YLRjCwg0YHQutC+0LvRjNC60L4g0L/RgNC+0YjQu9C+INCy0YDQtdC80LXQvdC4INGBINC90LDRh9Cw0LvQsCDQsNC90LjQvNCw0YbQuNC4XG4gICAgdmFyIHRpbWVQYXNzZWQgPSB0aW1lIC0gc3RhcnQ7XG5cbiAgICAvLyDQstC+0LfQvNC+0LbQvdC+INC90LXQsdC+0LvRjNGI0L7QtSDQv9GA0LXQstGL0YjQtdC90LjQtSDQstGA0LXQvNC10L3QuCwg0LIg0Y3RgtC+0Lwg0YHQu9GD0YfQsNC1INC30LDRhNC40LrRgdC40YDQvtCy0LDRgtGMINC60L7QvdC10YZcbiAgICBpZiAodGltZVBhc3NlZCA+IGR1cmF0aW9uKSB0aW1lUGFzc2VkID0gZHVyYXRpb247XG5cbiAgICAvLyDQvdCw0YDQuNGB0L7QstCw0YLRjCDRgdC+0YHRgtC+0Y/QvdC40LUg0LDQvdC40LzQsNGG0LjQuCDQsiDQvNC+0LzQtdC90YIgdGltZVBhc3NlZFxuICAgIGRyYXcodGltZVBhc3NlZCk7XG5cbiAgICAvLyDQtdGB0LvQuCDQstGA0LXQvNGPINCw0L3QuNC80LDRhtC40Lgg0L3QtSDQt9Cw0LrQvtC90YfQuNC70L7RgdGMIC0g0LfQsNC/0LvQsNC90LjRgNC+0LLQsNGC0Ywg0LXRidGRINC60LDQtNGAXG4gICAgaWYgKHRpbWVQYXNzZWQgPCBkdXJhdGlvbikge1xuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xuICAgIH1cblxuICB9KTtcbn1cblxuXG52YXIgY29uZmlnID0ge1xuXHRjb2xvcnM6IHtcblx0XHRuZXV0cmFsOiAnI0ZGQTcwMCcsIC8vICM4RDk5QUUgIzEwN0U3RFxuXHRcdHN1Y2Nlc3M6ICcjQzJFODEyJyxcblx0XHRmYWlsOiAnI0I4MEMwOSdcblx0fSxcblx0bW92ZW1lbnRzOiB7XG5cdFx0cmFkaXVzUGVyY2VudDogNCxcblx0XHRzdHJva2VXaWR0aFBlcmNlbnQ6IDAuNVxuXHR9XG59XG5cblxuLy8gKioqKioqKioqKlxuLy8gKiBDQU5WQVMgKlxuLy8gKioqKioqKioqKlxuXG4vLyBDaGFuZ2VzIGNhbnZhcyBiYWNrZ3JvdW5kIHNpemUgd2hlbiBmaXJlZFxuZnVuY3Rpb24gcmVmcmVzaENvbXB1dGVkU2l6ZXMob2JqZWN0KSB7XG5cdFxuXHRjb25maWcuY2Fudk9wdHMuY29tcHV0ZWRTdHlsZSA9IHtcblx0XHR3aWR0aDogK29iamVjdC53aWR0aC5zbGljZSgwLC0yKSxcblx0XHRoZWlnaHQ6ICtvYmplY3QuaGVpZ2h0LnNsaWNlKDAsLTIpXG5cdH07XG5cblx0Y2FudmFzLnNldERpbWVuc2lvbnMoe1xuXHRcdHdpZHRoOiBjb25maWcuY2Fudk9wdHMuY29tcHV0ZWRTdHlsZS53aWR0aCxcblx0XHRoZWlnaHQ6IGNvbmZpZy5jYW52T3B0cy5jb21wdXRlZFN0eWxlLmhlaWdodFxuXHR9KTtcblxufVxuXG5mdW5jdGlvbiBhZGRNb3ZlbWVudE9uQ2FudmFzKG1vdmVtZW50SW5mbykge1xuXG5cdHZhciByYWRpdXMgPSBjb25maWcuY2Fudk9wdHMubW92ZW1lbnRzLnJhZGl1cztcblx0dmFyIHN0cm9rZVdpZHRoID0gY29uZmlnLmNhbnZPcHRzLm1vdmVtZW50cy5zdHJva2VXaWR0aDtcblx0Ly8gdmFyIHggPSBNYXRoLnJvdW5kKGNvbmZpZy5jYW52T3B0cy5jb21wdXRlZFN0eWxlLndpZHRoIC0gKGNvbmZpZy5jYW52T3B0cy5jb21wdXRlZFN0eWxlLndpZHRoLzEwMCkqMykgLSByYWRpdXMqMjtcblx0dmFyIHggPSBNYXRoLnJvdW5kKGNvbmZpZy5jYW52T3B0cy5jb21wdXRlZFN0eWxlLndpZHRoKTtcblx0dmFyIHkgPSBNYXRoLnJvdW5kKGNvbmZpZy5vbmVIUGVyY2VudCAqIDQ1KTtcblxuXHQvLyBjb25zb2xlLmxvZyh4ICsgJyAtICcgKyB5KTtcblxuXHR2YXIgbW92ZW1lbnQgPSBuZXcgZmFicmljLkNpcmNsZSh7XG5cdFx0ZmlsbDogbW92ZW1lbnRJbmZvLmNvbG9yLFxuXHRcdHN0cm9rZTogJyNGRkZGRkYnLFxuXHRcdHN0cm9rZVdpZHRoOiBzdHJva2VXaWR0aCxcblx0XHRyYWRpdXM6IHJhZGl1cyxcblx0XHQvLyByYWRpdXM6IDEwMCxcblx0XHR0b3A6IHksXG5cdFx0bGVmdDogeFxuXHRcdC8vIGxlZnQ6IDI2MlxuXHR9KTtcblxuXHRtb3ZlbWVudEluZm8uY2FudmFzT2JqZWN0ID0gbW92ZW1lbnRcblxuXHRjb25zb2xlLmxvZyhtb3ZlbWVudCk7XG5cdGNhbnZhcy5hZGQobW92ZW1lbnQpO1xuXHRjYW52YXMucmVuZGVyQWxsKCk7XG5cdC8vIG1vdmVtZW50SW5mby5zdGF0ZSA9ICdhZGRlZCc7XG59XG5cblxuLy8gQWN0aW9ucyBwZXJmb3JtZWQgd2hlbiBjdXJyZW50IGdhbWUgc2V0dGluZ3MgcmVjaWV2ZWRcbmZ1bmN0aW9uIG9uQWdTZXR1cEV2ZW50KGV2ZW50KSB7XG5cblx0bGV0IGF1ZGlvRmlsZVVSTCA9ICdodHRwOi8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArICcvc29uZ3MvJyArIGV2ZW50LmRldGFpbC5zb25nO1xuXHQvLyBsZXQgYXVkaW9GaWxlVVJMID0gJy4uL2F1ZGlvLycgKyBldmVudC5kZXRhaWwuc29uZztcblxuXHQvLyBjb25zb2xlLmxvZyhhdWRpb0ZpbGVVUkwpO1xuXG5cdGNvbmZpZy5jdXJyZW50QXVkaW8gPSBuZXcgSG93bCh7XG5cdFx0dXJsczogW2F1ZGlvRmlsZVVSTF0sXG5cdFx0YXV0b3BsYXk6IGZhbHNlLFxuXHRcdHZvbHVtZTogMC44LFxuXHR9KTtcblxuXHRjb25maWcuY3VycmVudE1vdmVtZW50cyA9IGV2ZW50LmRldGFpbC5jb21tYW5kcy5tYXAoKGN1cnJlbnRWYWx1ZSwgaW5kZXgsIGFycmF5KSA9PiB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRpbmRleDogaW5kZXgsXG5cdFx0XHRcdG5hbWU6IGN1cnJlbnRWYWx1ZSxcblx0XHRcdFx0Y29sb3I6IGNvbmZpZy5jb2xvcnMubmV1dHJhbCxcblx0XHRcdH1cblx0fSk7XG5cblx0Ly8gQlBNLCBtaW5JbnRlcnZhbCwgYmVnaW5uaW5nIG9mZnNldFxuXHQvLyBjb25maWcuY3VycmVudEJwbSA9IGV2ZW50LmRldGFpbC5icG07XG5cdGNvbmZpZy5jdXJyZW50QnBtID0gMTI4O1xuXHRjb25maWcuY3VycmVudE1pbkludGVydmFsID0gKGNvbmZpZy5jdXJyZW50QnBtICogMTAwMCkgLyAoNjAgKiAxNik7XG5cdGNvbmZpZy5jdXJyZW50QmVnaW5uaW5nT2Zmc2V0ID0gZXZlbnQuZGV0YWlsLm9mZnNldDtcblxuXHQvLyBUZXN0XG5cdC8vIGFkZE1vdmVtZW50T25DYW52YXMoY29uZmlnLmN1cnJlbnRNb3ZlbWVudHNbMV0pO1xuXHRzdGFydCgpO1xuXG59XG5cbmZ1bmN0aW9uIHN0YXJ0KCkge1xuXHRjb25maWcuY3VycmVudFNjb3JlID0gMDtcblx0Y29uZmlnLmN1cnJlbnRTdGFydERhdGUgPSBEYXRlLm5vdygpO1xuXHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0bmV4dEJlYXQodHJ1ZSk7XG5cdH0sIGNvbmZpZy5jdXJyZW50QmVnaW5uaW5nT2Zmc2V0KTtcblx0Y29uZmlnLmN1cnJlbnRBdWRpby5zdGFydCgpO1xufVxuXG5mdW5jdGlvbiBuZXh0QmVhdChpc0ZpcnN0KSB7XG5cblx0Ly8gSWYgd2UncmUgaW4gdGhlIGJlZ2lubmluZyBvZiBzb25nXG5cdGlmIChpc0ZpcnN0ID09PSB0cnVlKSB7XG5cdFx0YWRkTW92ZW1lbnRPbkNhbnZhcyhjb25maWcuY3VycmVudE1vdmVtZW50c1swXSk7XG5cdFx0YW5pbWF0ZU1vdmVtZW50KGNvbmZpZy5jdXJyZW50TW92ZW1lbnRzWzBdKTtcblx0XHRzZXRUaW1lb3V0KG5leHRCZWF0LCBjb25maWcuY3VycmVudE1pbkludGVydmFsKTtcblx0XHRyZXR1cm47XG5cdH1cblxuXHQvLyBJbnNlcnQgbmV3IG1vdmVtZW50XG5cdHZhciBhcHBlYXJpbmdNb3ZlbWVudEluZGV4ID0gTWF0aC5mbG9vcigoRGF0ZS5ub3coKSAtIGNvbmZpZy5jdXJyZW50U3RhcnREYXRlKSAvIGNvbmZpZy5jdXJyZW50TWluSW50ZXJ2YWwpO1xuXHRjb25zb2xlLmxvZyhhcHBlYXJpbmdNb3ZlbWVudEluZGV4KTtcblx0dmFyIGFwcGVhcmluZ01vdmVtZW50ID0gY29uZmlnLmN1cnJlbnRNb3ZlbWVudHNbYXBwZWFyaW5nTW92ZW1lbnRJbmRleF07XG5cblx0YWRkTW92ZW1lbnRPbkNhbnZhcyhhcHBlYXJpbmdNb3ZlbWVudCk7XG5cdGFuaW1hdGVNb3ZlbWVudChhcHBlYXJpbmdNb3ZlbWVudCk7XG5cdHNldFRpbWVvdXQobmV4dEJlYXQsIGNvbmZpZy5jdXJyZW50TWluSW50ZXJ2YWwpO1xuXHRjb25zb2xlLmxvZyhhcHBlYXJpbmdNb3ZlbWVudEluZGV4KTtcblxufVxuXG5mdW5jdGlvbiBhbmltYXRlTW92ZW1lbnQobW92ZW1lbnRJbmZvKSB7XG5cdC8vIG1vdmVtZW50SW5mby5jYW52YXNPYmplY3QuYW5pbWF0ZSgnbGVmdCcsICcnKyhjb25maWcub25lV1BlcmNlbnQgKiAyMCksIHtcblx0Ly8gXHQvLyBvbkNoYW5nZTogY2FudmFzLnJlbmRlckFsbC5iaW5kKGNhbnZhcyksXG5cdC8vIFx0b25DaGFuZ2U6IHJlcXVlc3RBbmltYXRpb25GcmFtZShjYW52YXMucmVuZGVyQWxsLmJpbmQoY2FudmFzKSwgMTAwKSxcblx0Ly8gXHQvLyBkdXJhdGlvbjogY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCoxNlxuXHQvLyB9KTtcblxuXHRhbmltYXRlKGZ1bmN0aW9uKHRpbWUpe1xuXHRcdG1vdmVtZW50SW5mby5jYW52YXNPYmplY3Quc2V0TGVmdCggKHRpbWUvY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCoxNikgKyBjb25maWcub25lV1BlcmNlbnQqMjAgKTtcblx0XHRjYW52YXMucmVuZGVyQWxsLmJpbmQoY2FudmFzKTtcblx0fSwgY29uZmlnLmN1cnJlbnRNaW5JbnRlcnZhbCoxNik7XG59XG5cblxuLy8gTXV0ZXMgLyB1bm11dGVzIGF1ZGlvXG5mdW5jdGlvbiBvblZvbHVtZUJ0bkNsaWNrKGV2ZW50KSB7XG5cblx0aWYgKCFjb25maWcuY3VycmVudEF1ZGlvLm11dGVkKSB7XG5cblx0XHQvLyBDaGFuZ2Ugdmlld1xuXHRcdHRoaXMuY2hpbGROb2Rlc1sxXS5jbGFzc0xpc3QucmVtb3ZlKCdmYS12b2x1bWUtdXAnKTtcblx0XHR0aGlzLmNoaWxkTm9kZXNbMV0uY2xhc3NMaXN0LmFkZCgnZmEtdm9sdW1lLW9mZicpO1xuXG5cdFx0Ly8gTXV0ZVxuXHRcdGNvbmZpZy5jdXJyZW50QXVkaW8ubXV0ZSgpO1xuXHRcdGNvbmZpZy5jdXJyZW50QXVkaW8ubXV0ZWQgPSB0cnVlO1xuXHR9IGVsc2Uge1xuXG5cdFx0Ly8gQ2hhbmdlIHZpZXdcblx0XHR0aGlzLmNoaWxkTm9kZXNbMV0uY2xhc3NMaXN0LnJlbW92ZSgnZmEtdm9sdW1lLW9mZicpO1xuXHRcdHRoaXMuY2hpbGROb2Rlc1sxXS5jbGFzc0xpc3QuYWRkKCdmYS12b2x1bWUtdXAnKTtcblxuXHRcdC8vIFVubXV0ZVxuXHRcdGNvbmZpZy5jdXJyZW50QXVkaW8udW5tdXRlKCk7XG5cdFx0Y29uZmlnLmN1cnJlbnRBdWRpby5tdXRlZCA9IGZhbHNlO1xuXHR9XG5cdGNvbnNvbGUubG9nKHRoaXMpO1xuXG59XG5cbi8vIENoYW5nZSB2b2x1bWUgbGV2ZWwgb2YgY3VycmVudCBhdWRpb1xuZnVuY3Rpb24gb25Wb2x1bWVTbGlkZXJJbnB1dChldmVudCkge1xuXHRjb25maWcuY3VycmVudEF1ZGlvLnZvbHVtZSh0aGlzLnZhbHVlLzEwMCk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVNjb3JlKGFkZCkge1xuXG5cdHZhciBzY29yZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY29yZScpWzBdO1xuXHR2YXIgc2NvcmVOdW1iZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NvcmUtbnVtYmVyJylbMF07XG5cblx0c2NvcmUuY2xhc3NMaXN0LmFkZCgndXBkYXRlJyk7XG5cdHNldFRpbWVvdXQoKCk9Pnsgc2NvcmUuY2xhc3NMaXN0LnJlbW92ZSgndXBkYXRlJyk7IH0sIDQwMCk7XG5cblx0Y29uZmlnLmN1cnJlbnRTY29yZSArPSBwYXJzZUludChhZGQpXG5cdHNjb3JlTnVtYmVyLmlubmVySFRNTCA9IGNvbmZpZy5jdXJyZW50U2NvcmU7XG5cblx0cmV0dXJuIGNvbmZpZy5jdXJyZW50U2NvcmU7XG5cbn1cblxuXG5cblxuLy8gKioqKioqKipcbi8vICogSW5pdCAqXG4vLyAqKioqKioqKlxuXG5jb25maWcuY3VycmVudEF1ZGlvO1xuY29uZmlnLmN1cnJlbnRNb3ZlbWVudHMgPSBbXTtcbmNvbmZpZy5jdXJyZW50U2NvcmUgPSAwO1xuY29uZmlnLmN1cnJlbnRTdGFydERhdGUgPSAwO1xuXG4vLyBHZXQgY29tcHV0ZWQgc3R5bGVzIG9mIHdob2xlIHBhZ2Ugd3JhcHBlclxudmFyIGNhbnZhc0NvbXB1dGVkU3R5bGVPYmogPSBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy53cicpWzBdKTtcblxuXG4vLyBTZXQgY2FudmFzIG9wdGlvbnNcbmNvbmZpZy5vbmVXUGVyY2VudCA9IHBhcnNlSW50KGNhbnZhc0NvbXB1dGVkU3R5bGVPYmoud2lkdGguc2xpY2UoMCwtMikpLzEwMDtcbmNvbmZpZy5vbmVIUGVyY2VudCA9IHBhcnNlSW50KGNhbnZhc0NvbXB1dGVkU3R5bGVPYmouaGVpZ2h0LnNsaWNlKDAsLTIpKS8xMDA7XG5cbmNvbmZpZy5jYW52T3B0cyA9IHtcblx0YmdVUkw6ICcuLi9pbWcvYmctY3Jvd2QtMS5qcGcnLFxuXHRjb21wdXRlZFN0eWxlOiB7XG5cdFx0d2lkdGg6IGNvbmZpZy5vbmVXUGVyY2VudCoxMDAsXG5cdFx0aGVpZ2h0OiBjb25maWcub25lSFBlcmNlbnQqMTAwXG5cdH0sXG5cdG1vdmVtZW50czoge1xuXHRcdHJhZGl1czogY29uZmlnLm9uZVdQZXJjZW50ICogY29uZmlnLm1vdmVtZW50cy5yYWRpdXNQZXJjZW50LFxuXHRcdHN0cm9rZVdpZHRoOiBjb25maWcub25lV1BlcmNlbnQgKiBjb25maWcubW92ZW1lbnRzLnN0cm9rZVdpZHRoUGVyY2VudFxuXHR9XG59XG5cblxuLy8gSW5pdGlhbGl6ZSAnZmFicmljJyBjYW52YXMgb2JqXG52YXIgY2FudmFzID0gbmV3IGZhYnJpYy5TdGF0aWNDYW52YXMoJ2dhbWUnLCB7XG5cdHdpZHRoOiBjb25maWcuY2Fudk9wdHMuY29tcHV0ZWRTdHlsZS53aWR0aCxcblx0aGVpZ2h0OiBjb25maWcuY2Fudk9wdHMuY29tcHV0ZWRTdHlsZS5oZWlnaHQsXG59KTtcblxuLy8gdmFyIHRvcFRyaWFuZ2xlID0gbmV3IGZhYnJpYy5UcmlhbmdsZSh7XG4vLyBcdGZpbGw6IGNvbmZpZy5jb2xvcnMubmV1dHJhbCxcbi8vIFx0c3Ryb2tlOiAnI0ZGRkZGRicsXG4vLyBcdHN0cm9rZVdpZHRoOiBjb25maWcuY2Fudk9wdHMubW92ZW1lbnRzLnN0cm9rZVdpZHRoLFxuLy8gXHRoZWlnaHQ6IGNvbmZpZy5vbmVIUGVyY2VudCAqIDE1LFxuLy8gXHR3aWR0aDogY29uZmlnLm9uZWhQZXJjZW50ICogMTUsXG4vLyBcdHRvcDogKGNvbmZpZy5vbmVIUGVyY2VudCAqIDIwKSArIChjb25maWcub25lSFBlcmNlbnQgKiAxNSksXG4vLyBcdGxlZnQ6IChjb25maWcub25lV1BlcmNlbnQgKiAyMCkgKyAoY29uZmlnLm9uZUhQZXJjZW50ICogMTUpLFxuLy8gXHRjZW50ZXJlZFJvdGF0aW9uOiB0cnVlLFxuLy8gXHRhbmdsZTogMTgwXG4vLyB9KTtcblxuLy8gdmFyIGJvdHRvbVRyaWFuZ2xlID0gbmV3IGZhYnJpYy5UcmlhbmdsZSh7XG4vLyBcdGZpbGw6IGNvbmZpZy5jb2xvcnMubmV1dHJhbCxcbi8vIFx0c3Ryb2tlOiAnI0ZGRkZGRicsXG4vLyBcdHN0cm9rZVdpZHRoOiBjb25maWcuY2Fudk9wdHMubW92ZW1lbnRzLnN0cm9rZVdpZHRoLFxuLy8gXHRoZWlnaHQ6IGNvbmZpZy5vbmVIUGVyY2VudCAqIDE1LFxuLy8gXHR3aWR0aDogY29uZmlnLm9uZWhQZXJjZW50ICogMTUsXG4vLyBcdHRvcDogY29uZmlnLm9uZUhQZXJjZW50ICogNzUsXG4vLyBcdGxlZnQ6IGNvbmZpZy5vbmVXUGVyY2VudCAqIDE5LjVcbi8vIH0pO1xuXG5cbnZhciBzaGFkb3dDaXJjbGUgPSBuZXcgZmFicmljLkNpcmNsZSh7XG5cdC8vIGZpbGw6IGNvbmZpZy5jb2xvcnMubmV1dHJhbCxcblx0ZmlsbDogJ3JnYmEoMjAwLDIwMCwyMDAsMC4yKScsXG5cdHN0cm9rZTogJ3JnYmEoMjAwLDIwMCwyMDAsMSknLFxuXHRzdHJva2VXaWR0aDogY29uZmlnLmNhbnZPcHRzLm1vdmVtZW50cy5zdHJva2VXaWR0aCxcblx0cmFkaXVzOiBjb25maWcuY2Fudk9wdHMubW92ZW1lbnRzLnJhZGl1cyxcblx0dG9wOiBNYXRoLnJvdW5kKGNvbmZpZy5vbmVIUGVyY2VudCo0NSksXG5cdGxlZnQ6IGNvbmZpZy5vbmVXUGVyY2VudCAqIDIwXG59KVxuY2FudmFzLmFkZChzaGFkb3dDaXJjbGUpO1xuXG4vLyBTZXQgaGFuZGxlciBmb3IgZ2FtZSBzZXR1cCBldmVudFxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYWdTZXR1cEV2ZW50Jywgb25BZ1NldHVwRXZlbnQpO1xuXG4vLyAqKioqKioqKipcbi8vICogQXVkaW8gKlxuLy8gKioqKioqKioqXG5cbi8vIEFkZCBtdXRlZCBzdGF0ZSBzYXZpbmcgZmVhdHVyZSB0byBIb3dsIChhdWRpbyBsaWIpXG5Ib3dsLnByb3RvdHlwZS5tdXRlZCA9IGZhbHNlO1xuSG93bC5tdXRlZCA9IGZhbHNlO1xuXG4vLyBHZXQgdm9sdW1lIGJ1dHRvbiBlbGVtZW50XG52YXIgdm9sdW1lQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnZvbHVtZS1idG4nKVswXTtcbi8vIGFuZCBzZXQgb25DbGljayBldmVudCBoYW5kbGVyXG52b2x1bWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvblZvbHVtZUJ0bkNsaWNrKTtcblxuLy8gR2V0IHZvbHVtZSBsZXZlbCBzbGlkZXJcbnZhciB2b2x1bWVTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudm9sdW1lLWlucHV0JylbMF07XG4vLyBhbmQgc2V0IG9uSW5wdXQgZXZlbnQgaGFuZGxlclxudm9sdW1lU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25Wb2x1bWVTbGlkZXJJbnB1dClcblxuXG4vLyBDaGFuZ2UgY2FudmFzIGJhY2tncm91bmQgc2l6ZSBvbiB3aW5kb3cgcmVzaXplXG53aW5kb3cub25yZXNpemUgPSBmdW5jdGlvbigpe1xuXHRyZWZyZXNoQ29tcHV0ZWRTaXplcyhjYW52YXNDb21wdXRlZFN0eWxlT2JqKTtcblx0Y2FudmFzLnJlbmRlckFsbC5iaW5kKGNhbnZhcyk7XG59XG5cblxuXG5cblxuLy8gdGVzdFxuXG4vLyBjb25maWcuY3VycmVudEF1ZGlvID0gbmV3IEhvd2woe1xuLy8gXHRcdHVybHM6IFsnLi4vYXVkaW8vMTIgSG9tZS5tcDMnXSxcbi8vIFx0XHRhdXRvcGxheTogZmFsc2UsXG4vLyBcdFx0dm9sdW1lOiAwLjgsXG4vLyBcdH0pO1xuLy8gY29uZmlnLmN1cnJlbnRBdWRpby5wbGF5KCk7XG5cbndpbmRvdy51cGRhdGVTY29yZSA9IHVwZGF0ZVNjb3JlO1xuLy8gd2luZG93LmJsYSA9IGFkZE1vdmVtZW50T25DYW52YXM7XG4vLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBmdW5jdGlvbigpe1xuLy8gXHRjb25maWcuY3VycmVudE1vdmVtZW50c1sxXS5jYW52YXNPYmplY3QuYW5pbWF0ZSgnbGVmdCcsICctPTEwNTAnLCB7XG4vLyBcdFx0b25DaGFuZ2U6IGNhbnZhcy5yZW5kZXJBbGwuYmluZChjYW52YXMpLFxuLy8gXHRcdGR1cmF0aW9uOiAyNDAwLFxuLy8gXHRcdGVhc2luZzogZmFicmljLnV0aWwubGluZWFyXG4vLyBcdH0pO1xuLy8gfSk7XG5cbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
